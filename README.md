# -AOI Defect Classification-（自動光學檢查(AOI)瑕疵分類）
## 1. Introduction
### 1.1 Motivation
為了期末報告前往 AIdea 平台尋找題目，討論後我們在練習場上選擇了工研院提供的「AOI 瑕疵分類」題目，希望能通過 AOI 影像資料進行瑕疵分類，學習影像分析。
### 1.2 Technical Challenge
自動光學檢測應用於許多產品檢測流程上，當工廠接到多樣化產品的訂單時，透過人工檢測的方法已不足以應付，因此使用經由機器學習技術辨識 AOI 瑕疵影像，除了能夠大幅減少人力資源，配合產線更能提高效率，對於我們來說也是很好學習影像分類的題材。影像分類是我們初次接觸的領域，希望能從此題材中，學習尋找影像的特徵並研究影像分類模型。

## 2. Methodology
### 2.1 切割驗證資料集
訓練資料總共為 2528 張，而我們以 7 比 3 切割驗證資料集，因此切割後的訓練資料集為 1767 張，驗證資料集為 761 張。
### 2.2 資料不平衡處裡
◆ SMOTE + ENN
### 2.3 圖片特徵擷取
為了能將影像資料代入機器學習模型進行訓練，我們需要影像的特徵變數來描述資料，因此使用 Haralick feature extraction 對影像進行特徵擷取。Haralick texture 可用來描述物件表面的材質，當我們需要量化或比較材質表面的觸感、紋理、花紋時，可以考慮採用此法來描述其特徵。會採用此特徵擷取方法的原因為影像資料轉成灰階後中其灰度會呈現反覆的變化，利用此特性就會發現在任意兩個相距某距離的像素點之間呈現著一定比例的關係，也就是擁有灰度的空間相關特性。因此，透過 Haralick feature extraction 的特徵擷取，每筆影像資料會擷取出 52 個特徵變數，並利用這 52 個變數進行機器學習的模型建立。
### 2.4 模型訓練
模型訓練時我們採用了機器學習與深度學習兩種方式，機器學習使用 Random Forest 與 XGBoost，而深度學習則是嘗試 CNN。

## 3. Experimental Analysis
### 3.1 機器學習
機器學習中我們使用 Random Forest 以及 XGBoost 兩種模型進行訓練，並利用 Haralick feature extraction 對影像資料所提取的特徵變數代入模型。此外，再處理資料不平衡的方法上，我們嘗試使用 SMOTE + ENN 以及在模型中加入懲罰項兩種方法進行資料的處理。
#### 3.1.1 利用 SMOTE + ENN 處理資料不平衡
利用驗證集分別使用 Random Forest 及 XGBoost 模型進行驗證後的準確率僅有 0.44 及 0.56。因此，我們暫時不考慮使用 SMOTE + ENN 的方法處理資料不平衡
#### 3.1.2 利用在模型中加入懲罰項處理資料不平衡
### 3.2 深度學習
深度學習中，我們對 CNN 嘗試了各種參數或層數等，表五為各個嘗試的結果，而最佳的測試準確率為 83.58%。

## 4. Conclusion
這次自動光學檢查(AOI)瑕疵分類的專題這針對每張圖進行分類，並不是對每張圖的每個像素進行瑕疵的分類，所以相較於許多醫學影像資料算是在圖形辨識上比較單純的，在預測的表現上也不錯。在這次的專題中我們遇到了資料不平衡的問題，因此也嘗試 SMOTE 以及加入權重兩種方法進行了資料不平衡的處理。若是使用加入權重來調整資料不平衡的問題對於機器學習與深度學習的模型建立都可以有蠻好的效果，尤其是深度學習(CNN)的模型準確率提升許多。但若使用 SMOTE 處理資料不平衡會遇到資料變數過多的問題，所以們需要先進行 PCA 降維再使用 SMOTE，但這樣的模型準確率卻下降至 0.5 左右，我們猜測是因為我們將影像的每個像素做為變數，但並非固定幾個像素位置可以代表整張影像，因此第一主成分對於特徵變數也只有0.4 的解釋變異，因此將 PCA 降維後的主成分作為影像的特徵變數並不是一個適當的選擇。在未來若有機會繼續精進我們的專題，會希望從資料不平衡的處理配合深度學習的模型建立著手研究，因為在我們的嘗試中機器學習(Random Forest、XGBoost)的表現明顯比深度學習(CNN)來的好，但從我們的文獻來看深度學習的表現其實可以做到 0.9 以上的準確率，而根據我們的經驗資料不平衡對於深度學習的影響也特別的大，所以會希望可以多在這部分進行研究嘗試。

## 5. Citation
- Linlin Zhang, Yongqing Jin, Xuesong Yang, Xia Li, Xiaodong Duan, Yuan Sun, Hong Liu, Convolutional Neural Network Based Multi-label Classification of PCB Defects. The Journal of Engineering, volume number: 1612 – 1616, 2018.
- 許佳蓉，手機鏡頭塑膠鏡片表面瑕疵分類，2019。
- 賴威豪、曾紹崟，基於深度卷積神經網路之印刷電路板影像瑕疵分類(Defect Classification of Printed Circuit Board Based on Deep Convolutional Neural Networks)。




